--[[
Исправленный Anti-Aim скрипт для Roblox
Решена ошибка "attempt to call a nil value"
--]]

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- A. Безопасная конфигурация
local AA_Config = {
    Enabled = true,
    Pitch = "Down",
    Yaw = "Backward",
    SpinSpeed = 50
}

-- B. Проверка существования объектов
local function SafeApplyAntiAim()
    -- 1. Проверяем существование игрока
    if not LocalPlayer then return end
    
    -- 2. Проверяем существование персонажа
    local character = LocalPlayer.Character
    if not character then return end
    
    -- 3. Проверяем основную часть
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local primaryPart = character.PrimaryPart
    if not humanoid or not primaryPart then return end

    -- Применяем Anti-Aim
    humanoid.AutoRotate = false
    if AA_Config.Yaw == "Backward" then
        character:SetPrimaryPartCFrame(
            CFrame.new(primaryPart.Position, 
                      primaryPart.Position - primaryPart.CFrame.LookVector)
        )
    end
end

-- C. Защищенное подключение
local function InitializeAntiAim()
    -- 1. Проверяем доступность сервисов
    if not pcall(function()
        return game:GetService("Players")
    end) then return end

    -- 2. Создаем безопасное соединение
    local success, error = pcall(function()
        RunService.Heartbeat:Connect(function()
            if AA_Config.Enabled then
                SafeApplyAntiAim()
            end
        end)
    end)
    
    -- 3. Обработка ошибок
    if not success then
        warn("Ошибка инициализации Anti-Aim: " .. tostring(error))
    end
end

-- Запускаем скрипт
InitializeAntiAim()

print("Anti-Aim скрипт успешно загружен и работает")
