--[[
SENSATION.CC - Fixed Menu Visibility
--]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- A. Глобальные переменные
local mainGUI = nil
local isMenuVisible = false
local inputConnection = nil

-- B. Простое создание GUI
local function CreateMainGUI()
    -- Удаляем старый GUI если есть
    if mainGUI then
        mainGUI:Destroy()
    end
    
    -- Создаем новый GUI
    mainGUI = Instance.new("ScreenGui")
    mainGUI.Name = "SensationCC"
    mainGUI.Enabled = false
    mainGUI.Parent = CoreGui
    
    -- Основной фрейм
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 400, 0, 300)
    mainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    mainFrame.BorderSizePixel = 1
    mainFrame.BorderColor3 = Color3.fromRGB(60, 60, 60)
    mainFrame.Parent = mainGUI
    
    -- Заголовок
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 0, 40)
    titleLabel.Text = "SENSATION.CC"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 16
    titleLabel.Parent = mainFrame
    
    -- Кнопка закрытия
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 80, 0, 25)
    closeButton.Position = UDim2.new(1, -85, 0, 5)
    closeButton.Text = "Close [DEL]"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    closeButton.Parent = mainFrame
    
    closeButton.MouseButton1Click:Connect(function()
        mainGUI.Enabled = false
        isMenuVisible = false
    end)
    
    -- Текст контента
    local contentText = Instance.new("TextLabel")
    contentText.Size = UDim2.new(1, -20, 1, -60)
    contentText.Position = UDim2.new(0, 10, 0, 50)
    contentText.Text = "RAGEBOT:\n- AimBot: Enabled\n- Silent Aim: ON\n\nVISUALS:\n- ESP: Active\n- Boxes: ON\n\nPress DEL to hide menu"
    contentText.TextColor3 = Color3.fromRGB(200, 200, 200)
    contentText.BackgroundTransparency = 1
    contentText.TextXAlignment = Enum.TextXAlignment.Left
    contentText.TextYAlignment = Enum.TextYAlignment.Top
    contentText.Font = Enum.Font.Gotham
    contentText.TextSize = 12
    contentText.Parent = mainFrame
    
    return mainGUI
end

-- C. Простая система переключения
local function SetupToggleSystem()
    -- Отключаем старый обработчик
    if inputConnection then
        inputConnection:Disconnect()
    end
    
    -- Новый обработчик
    inputConnection = UserInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.Delete then
            -- Переключаем видимость
            isMenuVisible = not isMenuVisible
            mainGUI.Enabled = isMenuVisible
            
            if isMenuVisible then
                print("Menu OPENED")
            else
                print("Menu CLOSED")
            end
        end
    end)
end

-- D. Основная инициализация
local function Main()
    print("Initializing SENSATION.CC...")
    
    -- Создаем GUI
    CreateMainGUI()
    
    -- Даем время на создание
    wait(0.1)
    
    -- Настраиваем переключение
    SetupToggleSystem()
    
    print("SENSATION.CC ready! Press DEL to show/hide menu")
    print("Current menu state: " .. tostring(mainGUI.Enabled))
end

-- E. Запуск
local success, err = pcall(Main)

if not success then
    print("Error: " .. err)
    
    -- Альтернативный простой запуск
    local simpleGUI = Instance.new("ScreenGui")
    simpleGUI.Parent = CoreGui
    simpleGUI.Enabled = true
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 200)
    frame.Position = UDim2.new(0.5, -150, 0.5, -100)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.Parent = simpleGUI
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.Text = "SENSATION.CC\nMenu is active\nPress DEL key"
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Parent = frame
    
    mainGUI = simpleGUI
end
