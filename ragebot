--[[
Универсальный загрузчик скриптов для Roblox
Решает ошибку "attempt to call a nil value"
--]]

-- A. Проверка доступных функций загрузки
local function SafeLoadScript(url)
    -- 1. Проверяем наличие game:HttpGet
    if game and game.HttpGet then
        local success, result = pcall(function()
            return game:HttpGet(url)
        end)
        if success then return result end
    end
    
    -- 2. Проверяем наличие syn.request
    if syn and syn.request then
        local response = syn.request({
            Url = url,
            Method = "GET"
        })
        if response.Body then return response.Body end
    end
    
    -- 3. Альтернативные методы
    if http_request then
        local response = http_request({Url = url, Method = "GET"})
        if response.Body then return response.Body end
    end
    
    error("Не удалось загрузить скрипт")
end

-- B. Безопасное выполнение кода
local function ExecuteSecure(code)
    -- 1. Создаем защищенное окружение
    local env = {}
    setmetatable(env, {__index = _G})
    
    -- 2. Загружаем код с обработкой ошибок
    local fn, loadError = loadstring(code)
    if not fn then
        error("Ошибка загрузки: " .. tostring(loadError))
    end
    
    -- 3. Выполняем в изолированном окружении
    setfenv(fn, env)
    local success, execError = pcall(fn)
    if not success then
        error("Ошибка выполнения: " .. tostring(execError))
    end
end

-- C. Основная функция загрузки
local function LoadFromGitHub()
    local githubUrl = "https://raw.githubusercontent.com/your_username/your_repo/main/script.lua"
    
    -- 1. Загружаем код
    local scriptCode = SafeLoadScript(githubUrl)
    
    -- 2. Выполняем код
    ExecuteSecure(scriptCode)
    
    print("Скрипт успешно загружен и выполнен")
end

-- Запускаем загрузку
LoadFromGitHub()
